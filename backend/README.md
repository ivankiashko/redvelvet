# RedVelvet Backend - Secure Node.js API

–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π backend –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã RedVelvet —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Node.js, Express –∏ PostgreSQL.

## üîí –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ **Bcrypt** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π (12 rounds)
- ‚úÖ **JWT** —Ç–æ–∫–µ–Ω—ã (Access + Refresh tokens)
- ‚úÖ **Role-based access control** (client, model, admin)
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks** —á–µ—Ä–µ–∑ constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection
- ‚úÖ **Prepared statements** –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —á–µ—Ä–µ–∑ pg library
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

### 3. –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
- ‚úÖ **Helmet** –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ security headers
- ‚úÖ **Content Security Policy (CSP)**
- ‚úÖ **Sanitize-html** –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- ‚úÖ **Input validation** —á–µ—Ä–µ–∑ express-validator

### 4. –î—Ä—É–≥–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ **Rate limiting** (–∑–∞—â–∏—Ç–∞ –æ—Ç brute force –∏ DDoS)
- ‚úÖ **CORS** —Å –±–µ–ª—ã–º —Å–ø–∏—Å–∫–æ–º –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ **Error handling** –±–µ–∑ —É—Ç–µ—á–∫–∏ sensitive –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Request logging** –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **Parameter pollution protection**
- ‚úÖ **HTTPS enforcement** –≤ production

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+
- PostgreSQL 15+
- npm –∏–ª–∏ yarn

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd backend
npm install
```

2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ environment variables:
```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:
```env
NODE_ENV=development
PORT=3000

DB_HOST=localhost
DB_PORT=5432
DB_NAME=redvelvet
DB_USER=redvelvet_user
DB_PASSWORD=your_secure_password

JWT_SECRET=your_jwt_secret_min_32_chars_long
JWT_REFRESH_SECRET=your_jwt_refresh_secret_min_32_chars
```

3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:
```bash
createdb redvelvet
createuser redvelvet_user
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
npm run migrate
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
# Development
npm run dev

# Production
npm start
```

## üöÄ API Endpoints

### Authentication

#### POST /api/auth/register
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```json
{
  "email": "user@example.com",
  "password": "SecurePass123",
  "userType": "client",
  "phone": "+79123456789"
}
```

#### POST /api/auth/login
–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```json
{
  "email": "user@example.com",
  "password": "SecurePass123"
}
```

#### POST /api/auth/refresh
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token
```json
{
  "refreshToken": "your-refresh-token"
}
```

#### POST /api/auth/logout
–í—ã—Ö–æ–¥ (—Ç—Ä–µ–±—É–µ—Ç auth)
```json
{
  "refreshToken": "your-refresh-token"
}
```

#### GET /api/auth/me
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç auth)

### Profiles

#### GET /api/profiles
–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
Query params:
- `city` - –≥–æ—Ä–æ–¥
- `minAge`, `maxAge` - –¥–∏–∞–ø–∞–∑–æ–Ω –≤–æ–∑—Ä–∞—Å—Ç–∞
- `minPrice`, `maxPrice` - –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω
- `minRating` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
- `service` - —É—Å–ª—É–≥–∞
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (max: 100)

#### GET /api/profiles/:id
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ ID

#### POST /api/profiles
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Ç—Ä–µ–±—É–µ—Ç auth, —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–¥–µ–ª–µ–π)
```json
{
  "name": "–ê–Ω–Ω–∞",
  "age": 25,
  "city": "moscow",
  "height": 170,
  "weight": 55,
  "bustSize": "3",
  "eyeColor": "–ö–∞—Ä–∏–µ",
  "hairColor": "–ë—Ä—é–Ω–µ—Ç–∫–∞",
  "nationality": "–°–ª–∞–≤—è–Ω–∫–∞",
  "bodyType": "–°—Ç—Ä–æ–π–Ω–∞—è",
  "clothingSize": "S",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è...",
  "price": 5000,
  "services": ["–ö–ª–∞—Å—Å–∏–∫–∞", "–ú–∞—Å—Å–∞–∂"],
  "phone": "+79123456789"
}
```

#### PUT /api/profiles/:id
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Ç—Ä–µ–±—É–µ—Ç auth, —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)

#### DELETE /api/profiles/:id
–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Ç—Ä–µ–±—É–µ—Ç auth, —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- –ö–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞
- –ö–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞
- –ö–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞

### JWT –¢–æ–∫–µ–Ω—ã
- Access token: 1 —á–∞—Å
- Refresh token: 7 –¥–Ω–µ–π
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞

### Rate Limiting
- –û–±—â–∏–µ endpoints: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç
- Auth endpoints: 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç

### –í–∞–ª–∏–¥–∞—Ü–∏—è
–í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é express-validator:
- Email —Ñ–æ—Ä–º–∞—Ç
- –î–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫
- –ß–∏—Å–ª–æ–≤—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è enum
- XSS –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ sanitization

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `wallets` - –∫—Ä–∏–ø—Ç–æ–∫–æ—à–µ–ª—å–∫–∏
- `profiles` - –ø—Ä–æ—Ñ–∏–ª–∏ –º–æ–¥–µ–ª–µ–π
- `profile_images` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
- `reviews` - –æ—Ç–∑—ã–≤—ã
- `favorites` - –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `refresh_tokens` - JWT refresh —Ç–æ–∫–µ–Ω—ã

### –ò–Ω–¥–µ–∫—Å—ã
–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è:
- –ü–æ–∏—Å–∫ –ø–æ email
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ—Ä–æ–¥—É
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
- –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è

### –¢—Ä–∏–≥–≥–µ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
GET /health
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
- Uptime
- Timestamp
- Environment

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Development: –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ morgan
- Production: combined —Ñ–æ—Ä–º–∞—Ç
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å timestamp –∏ IP

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å:
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞–º–∏
- –ü–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
- –°–∫—Ä—ã—Ç–∏–µ–º sensitive –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ production
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

## üîß Development

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ë–î, –º–∏–≥—Ä–∞—Ü–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Middleware (auth, security, errors)
‚îÇ   ‚îú‚îÄ‚îÄ models/          # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã (auth helpers)
‚îÇ   ‚îú‚îÄ‚îÄ validators/      # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ server.js        # Entry point
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–º–µ—Ä env variables
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

### Scripts
- `npm start` - –∑–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
- `npm run dev` - –∑–∞–ø—É—Å–∫ —Å nodemon
- `npm run migrate` - –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - see LICENSE file for details

## üë• –ê–≤—Ç–æ—Ä

RedVelvet Development Team
```
